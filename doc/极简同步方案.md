# æç®€ä¸ªäººåŒæ­¥æ–¹æ¡ˆè®¾è®¡

## ğŸ¯ è®¾è®¡åŸåˆ™

### æ ¸å¿ƒç†å¿µ
- **æ—¶é—´æˆ³ä¼˜å…ˆ**ï¼šä½¿ç”¨æ›´æ–°æ—¶é—´è§£å†³å†²çªï¼Œä¿ç•™æœ€æ–°æ•°æ®
- **æ— è®¤è¯è®¾è®¡**ï¼šä¸ªäººä½¿ç”¨ï¼Œæ— éœ€ç™»å½•è®¤è¯  
- **æç®€æ¶æ„**ï¼šä¸ç»´æŠ¤è®¾å¤‡ä¿¡æ¯ã€åŒæ­¥å†å²ç­‰å¤æ‚æ•°æ®
- **éå¯¹ç§°åŠ å¯†**ï¼šå®¢æˆ·ç«¯é…ç½®å¯†é’¥ï¼Œä¿è¯æ•°æ®å®‰å…¨

## ğŸ—ï¸ ç®€åŒ–æ•°æ®ç»“æ„

### 1. å®¢æˆ·ç«¯æ•°æ®ç»“æ„
```json
{
    "baidu.com": {
        "groupKey": "baidu.com",
        "baseDomain": "baidu.com", 
        "appPackages": ["com.baidu.a"],
        "lastModified": "2025-01-01T12:30:00.000Z",
        "accounts": [{
            "id": "uuid-1234",
            "subDomain": "pan.baidu.com",
            "username": "admin",
            "password": "encrypted_password",
            "source": "æ’ä»¶",
            "createdTime": "2025-01-01T12:00:00.000Z",
            "modifyTime": "2025-01-01T12:30:00.000Z"
        }]
    }
}
```

### 2. æœåŠ¡ç«¯æ•°æ®è¡¨
```sql
CREATE TABLE sync_data (
    id VARCHAR(36) PRIMARY KEY,
    domain_group VARCHAR(255) UNIQUE NOT NULL,
    encrypted_data TEXT NOT NULL,
    data_hash VARCHAR(64) NOT NULL,
    last_modified TIMESTAMP NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 3. å®¢æˆ·ç«¯å¯†é’¥é…ç½®
```json
{
    "syncSettings": {
        "enabled": true,
        "serverUrl": "https://your-sync-server.com",
        "autoSync": true,
        "syncInterval": 300000,
        "publicKey": "-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----",
        "privateKey": "-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----"
    }
}
```

## ğŸ”„ åŒæ­¥æµç¨‹

### 1. ä¸Šä¼ åŒæ­¥æµç¨‹
```
å®¢æˆ·ç«¯æ•°æ®å˜æ›´ 
    â†“
è®¡ç®—æ•°æ®å“ˆå¸Œå’Œæ—¶é—´æˆ³
    â†“
éå¯¹ç§°åŠ å¯†æ•°æ®
    â†“
POST /api/sync/{domain}
    â†“
æœåŠ¡ç«¯æ—¶é—´æˆ³æ¯”è¾ƒ
    â†“
è¿”å›ç»“æœï¼š
- success: ä¸Šä¼ æˆåŠŸ
- conflict_resolved: æœåŠ¡ç«¯æ•°æ®æ›´æ–°ï¼Œè¿”å›æœåŠ¡ç«¯æ•°æ®
```

### 2. ä¸‹è½½åŒæ­¥æµç¨‹
```
GET /api/sync/{domain}
    â†“
æœåŠ¡ç«¯è¿”å›åŠ å¯†æ•°æ®
    â†“
å®¢æˆ·ç«¯è§£å¯†æ•°æ®
    â†“
åº”ç”¨åˆ°æœ¬åœ°å­˜å‚¨
```

### 3. å†²çªè§£å†³è§„åˆ™
- **æ—¶é—´æˆ³ä¼˜å…ˆ**ï¼šlastModified æ›´æ–°çš„æ•°æ®è·èƒœ
- **æ—¶é—´ç›¸åŒ**ï¼šä¿æŒæœåŠ¡ç«¯æ•°æ®ä¸å˜
- **æ— å¤æ‚åˆå¹¶**ï¼šç®€å•çš„æœ€æ–°æ•°æ®è¦†ç›–ç­–ç•¥

## ğŸ“¡ APIè®¾è®¡

### 1. è·å–æ•°æ®
```
GET /api/sync/{domainGroup}

Response:
{
    "status": "success",
    "data": {
        "domainGroup": "baidu.com",
        "encryptedData": {...},
        "lastModified": "2025-01-01T12:30:00.000Z",
        "hash": "abc123..."
    }
}
```

### 2. ä¸Šä¼ æ•°æ®
```
POST /api/sync/{domainGroup}
{
    "encryptedData": {...},
    "lastModified": "2025-01-01T12:30:00.000Z", 
    "hash": "abc123..."
}

Response (æˆåŠŸ):
{
    "status": "success",
    "data": {
        "domainGroup": "baidu.com",
        "lastModified": "2025-01-01T12:30:00.000Z",
        "hash": "abc123..."
    }
}

Response (å†²çªï¼ŒæœåŠ¡ç«¯æ›´æ–°):
{
    "status": "conflict_resolved",
    "data": {
        "domainGroup": "baidu.com",
        "encryptedData": {...},
        "lastModified": "2025-01-01T12:35:00.000Z",
        "hash": "def456..."
    }
}
```

### 3. è·å–æ‰€æœ‰åŸŸåç»„
```
GET /api/sync

Response:
{
    "status": "success",
    "data": [{
        "domainGroup": "baidu.com",
        "lastModified": "2025-01-01T12:30:00.000Z",
        "hash": "abc123..."
    }]
}
```

### 4. åˆ é™¤æ•°æ®
```
DELETE /api/sync/{domainGroup}

Response:
{
    "status": "success",
    "message": "æ•°æ®å·²åˆ é™¤"
}
```

## ğŸ” åŠ å¯†æ–¹æ¡ˆ

### 1. æ··åˆåŠ å¯†ï¼ˆRSA + AESï¼‰
- **RSA-2048**ï¼šåŠ å¯†AESå¯†é’¥
- **AES-256-GCM**ï¼šåŠ å¯†å®é™…æ•°æ®
- **å®¢æˆ·ç«¯ç”Ÿæˆå¯†é’¥å¯¹**ï¼šåœ¨æ’ä»¶è®¾ç½®ä¸­ç®¡ç†

### 2. åŠ å¯†æµç¨‹
```javascript
// 1. ç”ŸæˆAESå¯†é’¥
const aesKey = await crypto.subtle.generateKey({
    name: 'AES-GCM', 
    length: 256
}, true, ['encrypt', 'decrypt']);

// 2. AESåŠ å¯†æ•°æ®
const encryptedData = await crypto.subtle.encrypt({
    name: 'AES-GCM', 
    iv: randomIV
}, aesKey, dataBuffer);

// 3. RSAåŠ å¯†AESå¯†é’¥
const encryptedKey = await crypto.subtle.encrypt({
    name: 'RSA-OAEP'
}, publicKey, aesKeyBuffer);

// 4. è¿”å›æ··åˆåŠ å¯†åŒ…
return {
    type: 'hybrid',
    encryptedKey: base64(encryptedKey),
    encryptedData: base64(encryptedData),
    iv: base64(randomIV)
};
```

## ğŸ›ï¸ å®¢æˆ·ç«¯ç•Œé¢

### 1. åŒæ­¥è®¾ç½®é¡µé¢
```html
<div class="sync-settings">
    <h3>åŒæ­¥è®¾ç½®</h3>
    
    <!-- æœåŠ¡å™¨é…ç½® -->
    <div class="server-config">
        <label>æœåŠ¡å™¨åœ°å€:</label>
        <input type="url" id="serverUrl" placeholder="https://your-server.com">
        
        <label>
            <input type="checkbox" id="autoSync"> è‡ªåŠ¨åŒæ­¥
        </label>
    </div>
    
    <!-- å¯†é’¥ç®¡ç† -->
    <div class="key-section">
        <h4>åŠ å¯†å¯†é’¥</h4>
        <div class="key-actions">
            <button id="generateKeys">ç”Ÿæˆæ–°å¯†é’¥</button>
            <button id="importKeys">å¯¼å…¥å¯†é’¥</button>
            <button id="exportKeys">å¯¼å‡ºå¯†é’¥</button>
        </div>
        
        <div class="key-info">
            æŒ‡çº¹: <span id="keyFingerprint">æœªé…ç½®</span>
        </div>
    </div>
    
    <!-- åŒæ­¥æ“ä½œ -->
    <div class="sync-actions">
        <button id="testConnection">æµ‹è¯•è¿æ¥</button>
        <button id="syncNow">ç«‹å³åŒæ­¥</button>
        <button id="saveSettings">ä¿å­˜è®¾ç½®</button>
    </div>
    
    <!-- åŒæ­¥çŠ¶æ€ -->
    <div class="sync-status">
        çŠ¶æ€: <span id="statusText">å°±ç»ª</span>
        <div class="sync-log" id="syncLog"></div>
    </div>
</div>
```

### 2. å¯†é’¥ç®¡ç†åŠŸèƒ½
- **ç”Ÿæˆå¯†é’¥**ï¼šåœ¨å®¢æˆ·ç«¯ç”ŸæˆRSA-2048å¯†é’¥å¯¹
- **å¯¼å‡ºå¯†é’¥**ï¼šå¯¼å‡ºä¸ºJSONæ–‡ä»¶å¤‡ä»½
- **å¯¼å…¥å¯†é’¥**ï¼šä»å¤‡ä»½æ–‡ä»¶æ¢å¤å¯†é’¥
- **å¯†é’¥æŒ‡çº¹**ï¼šæ˜¾ç¤ºå…¬é’¥çš„SHA-256æ‘˜è¦å‰16ä½

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### 1. æœåŠ¡ç«¯ï¼ˆNode.js + SQLiteï¼‰
```javascript
// æç®€æœåŠ¡å™¨
const express = require('express');
const { Sequelize, DataTypes } = require('sequelize');

const app = express();
app.use(express.json());

// SQLiteæ•°æ®åº“
const sequelize = new Sequelize({
    dialect: 'sqlite',
    storage: './sync.db'
});

// æ•°æ®æ¨¡å‹
const SyncData = sequelize.define('SyncData', {
    domainGroup: { type: DataTypes.STRING, unique: true },
    encryptedData: DataTypes.TEXT,
    dataHash: DataTypes.STRING,
    lastModified: DataTypes.DATE
});

// APIè·¯ç”±
app.get('/api/sync/:domain', async (req, res) => {
    // è·å–æ•°æ®é€»è¾‘
});

app.post('/api/sync/:domain', async (req, res) => {
    // ä¸Šä¼ æ•°æ®é€»è¾‘ï¼ˆæ—¶é—´æˆ³å†²çªè§£å†³ï¼‰
});

app.listen(3000);
```

### 2. Dockeréƒ¨ç½²
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install --production
COPY . .
EXPOSE 3000
CMD ["node", "server.js"]
```

## âœ… æ ¸å¿ƒä¼˜åŠ¿

### 1. æç®€è®¾è®¡
- **æ— è®¤è¯å¤æ‚åº¦**ï¼šä¸ªäººä½¿ç”¨ï¼Œå»é™¤ç™»å½•æµç¨‹
- **æ— ç‰ˆæœ¬ç®¡ç†**ï¼šæ—¶é—´æˆ³ç›´æ¥æ¯”è¾ƒï¼Œç®€å•æœ‰æ•ˆ
- **æ— è®¾å¤‡è·Ÿè¸ª**ï¼šä¸éœ€è¦è®¾å¤‡æ³¨å†Œå’Œç®¡ç†

### 2. å®‰å…¨å¯é 
- **ç«¯åˆ°ç«¯åŠ å¯†**ï¼šæ•°æ®åœ¨å®¢æˆ·ç«¯åŠ å¯†ï¼ŒæœåŠ¡ç«¯åªå­˜å‚¨å¯†æ–‡
- **éå¯¹ç§°åŠ å¯†**ï¼šç§é’¥ä¸ç¦»å¼€å®¢æˆ·ç«¯
- **å¯†é’¥è‡ªç®¡ç†**ï¼šç”¨æˆ·å®Œå…¨æ§åˆ¶åŠ å¯†å¯†é’¥

### 3. æ˜“äºéƒ¨ç½²
- **è½»é‡æœåŠ¡ç«¯**ï¼šå•æ–‡ä»¶åº”ç”¨ï¼ŒSQLiteæ•°æ®åº“
- **Dockeræ”¯æŒ**ï¼šä¸€é”®éƒ¨ç½²åˆ°ä»»ä½•æ”¯æŒDockerçš„ç¯å¢ƒ
- **æˆæœ¬ä½å»‰**ï¼šæœ€å°åŒ–çš„èµ„æºéœ€æ±‚

è¿™ä¸ªæç®€æ–¹æ¡ˆä¸“é—¨ä¸ºä¸ªäººç”¨æˆ·è®¾è®¡ï¼Œå»é™¤äº†æ‰€æœ‰ä¸å¿…è¦çš„å¤æ‚åŠŸèƒ½ï¼Œä¸“æ³¨äºæ ¸å¿ƒçš„æ•°æ®åŒæ­¥éœ€æ±‚ã€‚ 